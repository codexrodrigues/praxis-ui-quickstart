// -----------------------------------------------
// Estilos globais do Quickstart
// - Mantém o tema Material v20 (tokens) e utilitários
// - Inclui dicas e comentários educativos para novos devs
// - Ordem Sass: @use deve vir antes de qualquer outra regra
// -----------------------------------------------
@use '@angular/material' as mat;

// CSS base do CDK Overlay (backdrop/containers de menus, dialogs, tooltips, etc.)
// Alternativa quando o projeto usa styles.css: adicione
// "node_modules/@angular/cdk/overlay-prebuilt.css" em angular.json > build.options.styles
@import "@angular/cdk/overlay-prebuilt.css";

// Tema Material 3 escuro com tokens
$primary-palette: mat.$cyan-palette;
$secondary-palette: mat.$violet-palette;
$tertiary-palette: mat.$rose-palette;

$dark-theme: mat.define-theme((
  color: (
    theme-type: dark,
    primary: $primary-palette,
    tertiary: $tertiary-palette,
  ),
  typography: (
    brand-family: 'Lexend, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif',
    bold-weight: 700,
  ),
  density: (
    scale: 0
  )
));

// Aplica tokens globais do tema dark
:root {
  @include mat.core-theme($dark-theme);
  @include mat.all-component-themes($dark-theme);
  /* Typographic color tokens for dark UI */
  --text-strong: #ebeff5;
  --text-body: #e6ebf2;
  --text-muted: rgba(255,255,255,0.72);
  --text-subtle: rgba(255,255,255,0.55);
  --accent: #60a5fa;
  --accent-2: #8b5cf6;
  --highlight: rgba(96,165,250,0.10);
  // Tokens de gradiente (personalizáveis) usados por inputs Material (fill/outline)
  // Ajuste --p-primary-gradient para mudar as cores do efeito
  /* Gradient tokens for inputs and brand accents */
  --p-primary-gradient: linear-gradient(90deg, #1f8a8a, #6c63ff);
  --p-input-gradient: var(--p-primary-gradient);
  /* Brand gradient */
  --brand-grad-start: #60a5fa; /* cyan-400 */
  --brand-grad-end: #8b5cf6;   /* violet-400 */
  /* HTTP badges palette (customizable) */
  --http-get-start: #34d399;   /* emerald-400 */
  --http-get-end: #10b981;     /* emerald-500 */
  --http-post-start: var(--brand-grad-start);
  --http-post-end: var(--brand-grad-end);
  --http-put-start: #f59e0b;   /* amber-500 */
  --http-put-end: #d97706;     /* amber-600 */
  --http-patch-start: #a78bfa; /* violet-300 */
  --http-patch-end: #8b5cf6;   /* violet-400 */
  --http-delete-start: #ef4444;/* red-500 */
  --http-delete-end: #dc2626;  /* red-600 */
  /* Alias: map workspace tokens (--md-sys-*) to Angular Material tokens (--mat-sys-*) */
  /* Core surfaces + text (with safe fallbacks to avoid transparency) */
  --md-sys-color-surface: var(--mat-sys-color-surface, #121212);
  --md-sys-color-surface-variant: var(--mat-sys-color-surface-variant, #2a2f36);
  --md-sys-color-surface-container-lowest: var(--mat-sys-color-surface-container-lowest, #0b0f14);
  --md-sys-color-surface-container-low: var(--mat-sys-color-surface-container-low, #151a20);
  --md-sys-color-surface-container: var(--mat-sys-color-surface-container, #1c1f24);
  --md-sys-color-surface-container-high: var(--mat-sys-color-surface-container-high, #22262c);
  --md-sys-color-surface-container-highest: var(--mat-sys-color-surface-container-highest, #262b31);
  --md-sys-color-on-surface: var(--mat-sys-color-on-surface, #e6ebf2);
  --md-sys-color-on-surface-variant: var(--mat-sys-color-on-surface-variant, #b7bcc6);
  --md-sys-color-outline-variant: var(--mat-sys-color-outline-variant, rgba(255,255,255,0.14));
  --md-sys-color-outline: var(--mat-sys-color-outline, rgba(255,255,255,0.24));

  /* Brand and states */
  --md-sys-color-primary: var(--mat-sys-color-primary, #4cc9f0);
  --md-sys-color-on-primary: var(--mat-sys-color-on-primary, #ffffff);
  --md-sys-color-primary-container: var(--mat-sys-color-primary-container, #0e7aa3);
  --md-sys-color-on-primary-container: var(--mat-sys-color-on-primary-container, #d0f0ff);
  --md-sys-color-secondary: var(--mat-sys-color-secondary, #b39ddb);
  --md-sys-color-on-secondary: var(--mat-sys-color-on-secondary, #1b1327);
  --md-sys-color-secondary-container: var(--mat-sys-color-secondary-container, #3a2c5e);
  --md-sys-color-on-secondary-container: var(--mat-sys-color-on-secondary-container, #e8dcff);
  --md-sys-color-tertiary: var(--mat-sys-color-tertiary, #ff8fab);
  --md-sys-color-tertiary-container: var(--mat-sys-color-tertiary-container, #5a2231);
  --md-sys-color-on-tertiary-container: var(--mat-sys-color-on-tertiary-container, #ffd9e1);
  --md-sys-color-error: var(--mat-sys-color-error, #ffb4ab);
  --md-sys-color-error-container: var(--mat-sys-color-error-container, #8c1d18);
  --md-sys-color-on-error-container: var(--mat-sys-color-on-error-container, #ffdad6);
  --md-sys-color-background: var(--mat-sys-color-background, var(--mat-sys-color-surface, #121212));
}
html, body { height: 100%; }

// Global default font for non‑Material text
body {
  font-family: 'Lexend', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  font-size: 15.5px;
  line-height: 1.55;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  color: var(--text-body);
}

// Gradiente e base do app
.app-dark {
  --app-bg: radial-gradient(1200px 800px at 10% -10%, rgba(0, 180, 200, 0.25), transparent 60%),
             radial-gradient(1000px 700px at 110% 10%, rgba(120, 80, 200, 0.25), transparent 60%),
             linear-gradient(180deg, #0b1118 0%, #0a0f15 100%);
  background: var(--app-bg) fixed;
  color: var(--mat-sys-color-on-surface, #e6e6e6);
}

// Importante para overlays: o CDK cria .cdk-overlay-container no <body>
// Duplicamos as CSS custom properties para que menus/dialogs herdem as mesmas cores
/* Ensure overlays inherit the same variables even when rendered outside app root */
.cdk-overlay-container, .cdk-global-overlay-wrapper {
  /* Core surfaces + text */
  --md-sys-color-surface: var(--mat-sys-color-surface, #121212);
  --md-sys-color-surface-variant: var(--mat-sys-color-surface-variant, #2a2f36);
  --md-sys-color-surface-container-lowest: var(--mat-sys-color-surface-container-lowest, #0b0f14);
  --md-sys-color-surface-container-low: var(--mat-sys-color-surface-container-low, #151a20);
  --md-sys-color-surface-container: var(--mat-sys-color-surface-container, #1c1f24);
  --md-sys-color-surface-container-high: var(--mat-sys-color-surface-container-high, #22262c);
  --md-sys-color-surface-container-highest: var(--mat-sys-color-surface-container-highest, #262b31);
  --md-sys-color-on-surface: var(--mat-sys-color-on-surface, #e6ebf2);
  --md-sys-color-on-surface-variant: var(--mat-sys-color-on-surface-variant, #b7bcc6);
  --md-sys-color-outline-variant: var(--mat-sys-color-outline-variant, rgba(255,255,255,0.14));
  --md-sys-color-outline: var(--mat-sys-color-outline, rgba(255,255,255,0.24));

  /* Brand and states */
  --md-sys-color-primary: var(--mat-sys-color-primary, #4cc9f0);
  --md-sys-color-on-primary: var(--mat-sys-color-on-primary, #ffffff);
  --md-sys-color-primary-container: var(--mat-sys-color-primary-container, #0e7aa3);
  --md-sys-color-on-primary-container: var(--mat-sys-color-on-primary-container, #d0f0ff);
  --md-sys-color-secondary: var(--mat-sys-color-secondary, #b39ddb);
  --md-sys-color-on-secondary: var(--mat-sys-color-on-secondary, #1b1327);
  --md-sys-color-secondary-container: var(--mat-sys-color-secondary-container, #3a2c5e);
  --md-sys-color-on-secondary-container: var(--mat-sys-color-on-secondary-container, #e8dcff);
  --md-sys-color-tertiary: var(--mat-sys-color-tertiary, #ff8fab);
  --md-sys-color-tertiary-container: var(--mat-sys-color-tertiary-container, #5a2231);
  --md-sys-color-on-tertiary-container: var(--mat-sys-color-on-tertiary-container, #ffd9e1);
  --md-sys-color-error: var(--mat-sys-color-error, #ffb4ab);
  --md-sys-color-error-container: var(--mat-sys-color-error-container, #8c1d18);
  --md-sys-color-on-error-container: var(--mat-sys-color-on-error-container, #ffdad6);
  --md-sys-color-background: var(--mat-sys-color-background, var(--mat-sys-color-surface, #121212));
}

// Estilo glassmorphism para painéis
.glass-panel {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(8px) saturate(120%);
  -webkit-backdrop-filter: blur(8px) saturate(120%);
  border-radius: 12px;
}

// Ajustes típicos
* { box-sizing: border-box; }
body, h1, h2, h3, h4, h5, h6, p { margin: 0; }

// Material Symbols Outlined (outlined icons with thin weight)
.material-symbols-outlined {
  font-variation-settings: 'FILL' 0, 'wght' 100, 'GRAD' -25, 'opsz' 24;
}

/* Gradient borders util (uses masking to preserve rounded corners) */
.gradient-border {
  position: relative;
  border: 1px solid transparent; /* inner separation */
}
.gradient-border::before {
  content: '';
  position: absolute;
  inset: 0; /* full box */
  padding: 1px; /* border thickness */
  border-radius: inherit;
  background: linear-gradient(135deg, var(--brand-grad-start), var(--brand-grad-end));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
}

/* Ensure Material dialog surfaces use M3 surface tokens (avoid transparency) */
.mat-mdc-dialog-container .mdc-dialog__surface {
  background: var(--md-sys-color-surface-container);
  color: var(--md-sys-color-on-surface);
}
.mat-mdc-dialog-container .mdc-dialog__content {
  background: var(--md-sys-color-surface);
  color: var(--md-sys-color-on-surface);
}

/*
  Angular Material input gradients (fill/outline)
  - Fill: pinta a linha inferior com gradiente no foco
  - Outline: desenha um “anel” com gradiente usando máscara (com fallback)
  Compatível com MDC / Material v15–v20
*/
/* Fill appearance: gradient line on focus */
.mat-mdc-form-field-appearance-fill.mat-focused .mdc-line-ripple::after {
  height: 2px;
  border-radius: 1px;
  background: var(--p-input-gradient) !important;
}

/* Outline appearance: gradient ring using masking */
.mat-mdc-form-field-appearance-outline .mat-mdc-text-field-wrapper.mdc-text-field--outlined {
  position: relative;
  overflow: visible;
}
.mat-mdc-form-field.mat-focused .mat-mdc-text-field-wrapper.mdc-text-field--outlined::after {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: var(--mdc-shape-medium, 8px);
  padding: 2px;
  background: var(--p-input-gradient);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  /* Keep the gradient ring behind all field internals */
  z-index: -1;
}
.mat-mdc-form-field.mat-focused .mdc-notched-outline__leading,
.mat-mdc-form-field.mat-focused .mdc-notched-outline__trailing,
.mat-mdc-form-field.mat-focused .mdc-notched-outline__notch {
  border-color: transparent !important;
}

/* Fallback when masking isn't supported (browsers antigos) */
@supports not ((mask-composite: exclude) or (-webkit-mask-composite: xor)) {
  .mat-mdc-form-field.mat-focused .mat-mdc-text-field-wrapper.mdc-text-field--outlined {
    border: 2px solid transparent;
    background:
      linear-gradient(0deg, transparent, transparent) padding-box,
      var(--p-input-gradient) border-box;
    border-radius: var(--mdc-shape-medium, 8px);
  }
}

/* Mantém o label legível cortando o anel (outline + label flutuado) */
/*
  Alinha a cor do “notch” do label com o próprio container do campo.
  - Preferir variáveis de seção do formulário, depois MDC filled/outlined
  - Fallback seguro para surface-container em temas escuros
  Obs.: não definimos a var aqui para permitir que pais (ex.: .praxis-dynamic-form)
  personalizem `--pfx-field-notch-bg`; usamos a var apenas como primeira opção.
*/
/* Ensure floating label always lifts above the gradient ring (focused or not) */
.mat-mdc-form-field-appearance-outline .mat-mdc-floating-label.mdc-floating-label--float-above,
.mat-mdc-form-field-appearance-fill .mat-mdc-floating-label.mdc-floating-label--float-above {
  position: relative;
  z-index: 2; /* ensure label text is above notch overlay */
}
.mat-mdc-form-field-appearance-outline .mat-mdc-floating-label.mdc-floating-label--float-above::before,
.mat-mdc-form-field-appearance-fill .mat-mdc-floating-label.mdc-floating-label--float-above::before {
  content: "";
  position: absolute;
  left: -8px; right: -8px; /* pequena margem ao redor do texto */
  top: 50%; transform: translateY(-50%);
  height: 1.35em; /* cobre a altura do label flutuado */
  /* usa a mesma cor percebida do container do campo para evitar faixa escura */
  background: var(
    --pfx-field-notch-bg,
    var(
      --pfx-form-section-surface,
      var(
        --mdc-outlined-text-field-container-color,
        var(
          --mdc-filled-text-field-container-color,
          var(--md-sys-color-surface-container, var(--md-sys-color-surface))
        )
      )
    )
  );
  border-radius: 6px;
  z-index: -1; /* atrás do texto, mas acima do anel por causa do pai */
  pointer-events: none;
}

/* Tema escuro: usa o container de superfície definido no tema */
.mdc-theme-dark .mat-mdc-form-field-appearance-outline .mat-mdc-floating-label.mdc-floating-label--float-above::before,
.mdc-theme-dark .mat-mdc-form-field-appearance-fill .mat-mdc-floating-label.mdc-floating-label--float-above::before {
  background: var(
    --pfx-field-notch-bg,
    var(
      --pfx-form-section-surface,
      var(
        --mdc-outlined-text-field-container-color,
        var(
          --mdc-filled-text-field-container-color,
          var(--md-sys-color-surface-container, var(--md-sys-color-surface, #2a3038))
        )
      )
    )
  );
}

/* Do NOT paint the full notch background (it spans field height).
   We only paint a small shim behind the floating label via ::before above. */
.mat-mdc-form-field-appearance-outline .mdc-notched-outline__notch,
.mat-mdc-form-field .mdc-notched-outline__notch {
  position: relative;
  z-index: 1; /* ensure notch area sits above the ring */
  /*overflow: visible; allow label/overlay to render beyond notch bounds */
}

/* Cut the top ring segment under the floating label by painting
   a small strip only within the notch area (focused and unfocused). */
.mat-mdc-form-field-appearance-outline .mdc-notched-outline__notch::after,
.mat-mdc-form-field .mdc-notched-outline__notch::after {
  content: "";
  position: absolute;
  left: 0; right: 0;
  top: -2px; /* aligns with outlined ring inset/padding */
  height: 8px; /* cover ring thickness with small safety */
  background: var(
    --pfx-field-notch-bg,
    var(
      --pfx-form-section-surface,
      var(
        --mdc-outlined-text-field-container-color,
        var(
          --mdc-filled-text-field-container-color,
          var(--md-sys-color-surface-container, var(--md-sys-color-surface))
        )
      )
    )
  ) !important;
  z-index: -1; /* above ring, below label (label z-index: 3) */
  pointer-events: none;
}

/* DEBUG toggle: add .debug-notch to <body> or :root to force red */
:root.debug-notch .mat-mdc-form-field-appearance-outline .mat-mdc-floating-label.mdc-floating-label--float-above::before,
body.debug-notch .mat-mdc-form-field-appearance-outline .mat-mdc-floating-label.mdc-floating-label--float-above::before,
:root.debug-notch .mat-mdc-form-field-appearance-fill .mat-mdc-floating-label.mdc-floating-label--float-above::before,
body.debug-notch .mat-mdc-form-field-appearance-fill .mat-mdc-floating-label.mdc-floating-label--float-above::before {
  background: rgba(255, 0, 64, 0.8) !important;
}
/* DEBUG: temporarily remove gradient ring to isolate notch layering */
:root.debug-notch .mat-mdc-form-field.mat-focused .mat-mdc-text-field-wrapper.mdc-text-field--outlined::after,
body.debug-notch .mat-mdc-form-field.mat-focused .mat-mdc-text-field-wrapper.mdc-text-field--outlined::after {
  content: none !important;
}
/* DEBUG: visualize outline box area */
:root.debug-notch .mat-mdc-form-field .mdc-notched-outline,
body.debug-notch .mat-mdc-form-field .mdc-notched-outline {
  outline: 2px dashed rgba(255,0,64,.6) !important;
}

/* DEBUG: remover bordas arredondadas dos inputs (outline e filled) */
.mat-mdc-text-field-wrapper { --mdc-shape-medium: 0px !important; border-radius: 0 !important; }
.mat-mdc-form-field .mdc-notched-outline,
.mat-mdc-form-field .mdc-notched-outline__leading,
.mat-mdc-form-field .mdc-notched-outline__trailing { border-radius: 0 !important; }

/* Contexto: formularios da lib praxis-dynamic-form usam seções com
   background var(--pfx-form-section-surface, var(--md-sys-color-surface-container)).
   Propagamos a mesma cor para o notch do label via CSS var. */
.praxis-dynamic-form {
  --pfx-field-notch-bg: var(--pfx-form-section-surface, var(--md-sys-color-surface-container));
}

/* Typographic harmony (content area including Praxis Table page) */
.content-card__body {
  /* Base text */
  p { margin: 8px 0 12px; color: var(--text-body); }
  .muted, small { color: var(--text-muted); }
  .subtle { color: var(--text-subtle); }
  .lead { font-size: 16.5px; line-height: 1.6; color: var(--text-body); }
  a { color: #89b8ff; text-decoration: none; }
  a:hover { text-decoration: underline; }

  /* Headings scale */
  h1, h2, h3, h4, h5, h6 { color: var(--text-strong); font-weight: 700; margin: 10px 0 6px; letter-spacing: .1px; }
  h1 { font-size: 22px; line-height: 1.3; }
  h2 { font-size: 19px; line-height: 1.35; }
  h3 { font-size: 17px; line-height: 1.4; }
  h4 { font-size: 15.5px; line-height: 1.45; }
  h5 { font-size: 14.5px; line-height: 1.45; }
  h6 { font-size: 13.5px; line-height: 1.45; }

  /* Emphasis */
  mark, .highlight { background: var(--highlight); color: var(--text-strong); padding: 0 2px; border-radius: 2px; }
  strong { font-weight: 700; color: var(--text-strong); }

  /* Lists */
  ul, ol { margin: 6px 0 10px 18px; }
  li { margin: 4px 0; }

  /* Tables (PraxisTable + Material) */
  praxis-table, .mat-mdc-table { font-size: 14.5px; line-height: 1.45; font-variant-numeric: tabular-nums; }
  /* Row density and spacing */
  .mat-mdc-header-row, .mat-mdc-row { height: 40px; }
  .mat-mdc-header-cell, .mat-mdc-cell { padding: 8px 12px; }
  .mat-mdc-header-cell { font-weight: 600; color: var(--text-strong); letter-spacing: .2px; }
  .mat-mdc-cell { color: var(--text-body); }
  .mat-mdc-paginator { font-size: 13px; color: var(--text-muted); }

  /* Praxis table toolbar */
  praxis-table-toolbar { display: block; padding: 6px 8px; border-bottom: 1px solid rgba(255,255,255,.14); background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)); border-top-left-radius: 6px; border-top-right-radius: 6px; }
  praxis-table-toolbar [end-actions],
  praxis-table-toolbar [toolbar],
  praxis-table-toolbar [advancedFilter] { display: inline-flex; align-items: center; gap: 6px; }

  /* Code blocks styling in main area */
  .code-demo pre { background: rgba(10,14,20,0.75); padding: 10px; border-radius: 6px; overflow: auto; border: 1px solid rgba(255,255,255,0.12); }
  .code-demo code { color: #eaeaf1; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12.5px; }
}

/* Material: gradient primary buttons (flat/raised/FAB) */
.mat-mdc-unelevated-button.mat-primary,
.mat-mdc-raised-button.mat-primary,
.mat-mdc-fab.mat-primary,
.mat-mdc-mini-fab.mat-primary {
  background-image: linear-gradient(90deg, var(--brand-grad-start), var(--brand-grad-end));
  color: #fff;
  border: 1px solid rgba(255,255,255,0.18);
}
.mat-mdc-unelevated-button.mat-primary:hover,
.mat-mdc-raised-button.mat-primary:hover,
.mat-mdc-fab.mat-primary:hover,
.mat-mdc-mini-fab.mat-primary:hover {
  filter: brightness(1.06);
}
.mat-mdc-unelevated-button.mat-primary:active,
.mat-mdc-raised-button.mat-primary:active,
.mat-mdc-fab.mat-primary:active,
.mat-mdc-mini-fab.mat-primary:active {
  filter: brightness(0.95);
}
.mat-mdc-unelevated-button.mat-primary.mat-mdc-button-disabled,
.mat-mdc-raised-button.mat-primary.mat-mdc-button-disabled,
.mat-mdc-fab.mat-primary.mat-mdc-button-disabled,
.mat-mdc-mini-fab.mat-primary.mat-mdc-button-disabled {
  background-image: none;
}

/* Material: outlined primary with gradient outline */
.mat-mdc-outlined-button.mat-primary {
  border-color: transparent !important;
  position: relative;
}
.mat-mdc-outlined-button.mat-primary::before {
  content: '';
  position: absolute; inset: 0;
  padding: 1px; border-radius: inherit;
  background: linear-gradient(90deg, var(--brand-grad-start), var(--brand-grad-end));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  pointer-events: none;
}
